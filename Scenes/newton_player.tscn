[gd_scene load_steps=16 format=3 uid="uid://3716brh3f04n"]

[ext_resource type="PackedScene" uid="uid://cyb2l1vcms8n0" path="res://addons/Godot-OpenXR-Startup/OpenXR Startup/CameraRig.tscn" id="1_o26st"]
[ext_resource type="PackedScene" uid="uid://c8ccdoo0nk1uy" path="res://addons/Godot-VR-Body-Solver/Scenes/SkeletalAvatar.tscn" id="2_0fogy"]
[ext_resource type="PackedScene" uid="uid://bo3f3lg1xqgqb" path="res://addons/Godot-VR-Body-Solver/Scenes/PreparedBodySolver.tscn" id="3_gfmwf"]
[ext_resource type="Script" path="res://addons/Newton/Scripts/LegsJoint.cs" id="4_7bptw"]
[ext_resource type="Script" path="res://addons/Newton/Scripts/CoreRB.cs" id="4_jlr6y"]
[ext_resource type="Script" path="res://addons/Newton/Scripts/LocosphereMovement.cs" id="4_w6sr6"]
[ext_resource type="Script" path="res://addons/Newton/Scripts/MoveWithChest.cs" id="6_0bglg"]
[ext_resource type="PackedScene" uid="uid://ta178svgkj7b" path="res://addons/Godot-Extras/Axis Helper/Axis Helper.tscn" id="6_qk7u3"]

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_7mq57"]
friction = 10.0
rough = true

[sub_resource type="SphereShape3D" id="SphereShape3D_lmjnj"]
radius = 0.25

[sub_resource type="SphereMesh" id="SphereMesh_jj4w0"]
radius = 0.25
height = 0.5

[sub_resource type="BoxShape3D" id="BoxShape3D_gp6i1"]
size = Vector3(0.32, 0.5, 0.2)

[sub_resource type="BoxMesh" id="BoxMesh_8hf0b"]
size = Vector3(0.32, 0.5, 0.2)

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_oq1ph"]
radius = 0.08
height = 0.27

[sub_resource type="CapsuleMesh" id="CapsuleMesh_vcfel"]
radius = 0.08
height = 0.27

[node name="NewtonPlayer" type="Node3D"]

[node name="CameraRig" parent="." instance=ExtResource("1_o26st")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)

[node name="Camera" parent="CameraRig" index="0"]
near = 0.026

[node name="SkeletalAvatar" parent="CameraRig" node_paths=PackedStringArray("Solver") instance=ExtResource("2_0fogy")]
Solver = NodePath("../../BodySolver")

[node name="Axis Helper" parent="CameraRig/SkeletalAvatar/Eyes" index="1"]
visible = false

[node name="BodySolver" parent="." node_paths=PackedStringArray("CameraRig") instance=ExtResource("3_gfmwf")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
CameraRig = NodePath("../CameraRig")

[node name="PhysicsRig" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)

[node name="Locosphere" type="RigidBody3D" parent="PhysicsRig" node_paths=PackedStringArray("_BodySolver")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.75, 0)
physics_material_override = SubResource("PhysicsMaterial_7mq57")
can_sleep = false
script = ExtResource("4_w6sr6")
_BodySolver = NodePath("../../BodySolver")
_DeadzoneRadius = 0.1
_AngVelMultiplier = 10.0

[node name="LocosphereCollision" type="CollisionShape3D" parent="PhysicsRig/Locosphere"]
shape = SubResource("SphereShape3D_lmjnj")

[node name="LocosphereMesh" type="MeshInstance3D" parent="PhysicsRig/Locosphere/LocosphereCollision"]
mesh = SubResource("SphereMesh_jj4w0")
skeleton = NodePath("../..")

[node name="LegsJoint" type="Generic6DOFJoint3D" parent="PhysicsRig/Locosphere" node_paths=PackedStringArray("_ChestMount", "_CamRig", "_BodySolver", "_LocosphereCollision")]
node_a = NodePath("../../Core")
node_b = NodePath("..")
linear_limit_y/enabled = false
linear_limit_y/upper_distance = 1.0
linear_spring_y/enabled = true
linear_spring_y/stiffness = 400.0
linear_spring_y/damping = 10.0
linear_spring_y/equilibrium_point = 0.9
angular_limit_x/enabled = false
angular_limit_y/enabled = false
angular_limit_z/enabled = false
script = ExtResource("4_7bptw")
_ChestMount = NodePath("../../Core/ChestMount")
_CamRig = NodePath("../../../CameraRig")
_BodySolver = NodePath("../../../BodySolver")
_LocosphereCollision = NodePath("../LocosphereCollision")
_JumpCrouchSpeed = 2.0
_MaxCrouchEquilibrium = 1.0

[node name="Axis Helper" parent="PhysicsRig/Locosphere" instance=ExtResource("6_qk7u3")]
transform = Transform3D(0.15, 0, 0, 0, 0.15, 0, 0, 0, 0.15, 0, 0, 0)

[node name="Core" type="RigidBody3D" parent="PhysicsRig" node_paths=PackedStringArray("_ChestMount", "_CamRig", "_BodySolver")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.75, 0)
axis_lock_angular_x = true
axis_lock_angular_y = true
axis_lock_angular_z = true
can_sleep = false
script = ExtResource("4_jlr6y")
_ChestMount = NodePath("ChestMount")
_CamRig = NodePath("../../CameraRig")
_BodySolver = NodePath("../../BodySolver")

[node name="ChestCollision" type="CollisionShape3D" parent="PhysicsRig/Core"]
shape = SubResource("BoxShape3D_gp6i1")

[node name="ChestMesh" type="MeshInstance3D" parent="PhysicsRig/Core/ChestCollision"]
mesh = SubResource("BoxMesh_8hf0b")
skeleton = NodePath("../..")

[node name="CollisionShape3D" type="CollisionShape3D" parent="PhysicsRig/Core"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.411492, -0.092548)
shape = SubResource("CapsuleShape3D_oq1ph")

[node name="HeadMesh" type="MeshInstance3D" parent="PhysicsRig/Core/CollisionShape3D"]
mesh = SubResource("CapsuleMesh_vcfel")
skeleton = NodePath("../..")

[node name="ChestMount" type="Node3D" parent="PhysicsRig/Core"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.25, 0)

[node name="MoveWithChest" type="Node" parent="PhysicsRig" node_paths=PackedStringArray("_BodySolver", "_CameraRig", "_RigRigidbodies")]
script = ExtResource("6_0bglg")
_BodySolver = NodePath("../../BodySolver")
_CameraRig = NodePath("../../CameraRig")
_RigRigidbodies = [NodePath("../Locosphere"), NodePath("../Core")]

[connection signal="input_vector2_changed" from="CameraRig/LeftHand" to="PhysicsRig/Locosphere" method="ControllerVec2Input"]
[connection signal="button_pressed" from="CameraRig/RightHand" to="PhysicsRig/Locosphere/LegsJoint" method="ControllerButtonPressed"]
[connection signal="button_released" from="CameraRig/RightHand" to="PhysicsRig/Locosphere/LegsJoint" method="ControllerButtonReleased"]
[connection signal="input_vector2_changed" from="CameraRig/RightHand" to="PhysicsRig/Locosphere/LegsJoint" method="ControllerVec2Changed"]

[editable path="CameraRig"]
[editable path="CameraRig/SkeletalAvatar"]
[editable path="CameraRig/SkeletalAvatar/Eyes"]
[editable path="CameraRig/SkeletalAvatar/Neck"]
[editable path="CameraRig/SkeletalAvatar/Chest"]
[editable path="CameraRig/SkeletalAvatar/Spine"]
[editable path="CameraRig/SkeletalAvatar/Body Direction"]
[editable path="CameraRig/SkeletalAvatar/LShoulder"]
[editable path="CameraRig/SkeletalAvatar/LElbow"]
[editable path="CameraRig/SkeletalAvatar/LWrist"]
[editable path="CameraRig/SkeletalAvatar/LHips"]
[editable path="CameraRig/SkeletalAvatar/LKnee"]
[editable path="CameraRig/SkeletalAvatar/LAnkle"]
[editable path="CameraRig/SkeletalAvatar/LToe"]
[editable path="CameraRig/SkeletalAvatar/RShoulder"]
[editable path="CameraRig/SkeletalAvatar/RElbow"]
[editable path="CameraRig/SkeletalAvatar/RWrist"]
[editable path="CameraRig/SkeletalAvatar/RHips"]
[editable path="CameraRig/SkeletalAvatar/RKnee"]
[editable path="CameraRig/SkeletalAvatar/RAnkle"]
[editable path="CameraRig/SkeletalAvatar/RToe"]
